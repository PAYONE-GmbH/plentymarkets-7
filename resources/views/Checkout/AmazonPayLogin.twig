<script type="text/javascript">
    $(document).ready(function () {

        if ({{ selectedPaymentId }} == {{ amazonPayMopId }}) {
            document.getElementById("LoginWithAmazon").style.display = "block";
        }

        document.addEventListener("afterPaymentMethodChanged", function (e) {
            if (e.detail == {{ amazonPayMopId }}) {
                document.getElementById("LoginWithAmazon").style.display = "block";
            } else {
                document.getElementById("LoginWithAmazon").style.display = "none";
            }
        });
    });
    window.onAmazonLoginReady = function () {
        console.log('{{ content.clientId }}');

        amazon.Login.setClientId('{{ content.clientId }}');
    };
    window.onAmazonPaymentsReady = function () {
        console.log('Client-ID: {{ content.clientId }}');
        console.log('Seller-ID: {{ content.sellerId }}');
        console.log('WorkOrder-ID: {{ content.workOrderId }}');

        var authRequest;

        OffAmazonPayments.Button('LoginWithAmazon', '{{ content.sellerId }}', {
            type: '{{ content.type }}',
            color: '{{ content.color }}',
            size: '{{ content.size }}',
            language: '{{ content.language }}',

            authorization: function () {
                loginOptions = {scope: '{{ content.scopes }}', popup: {{ content.popup }}};
                authRequest = amazon.Login.authorize(loginOptions, function (t) {
                    console.log(t.access_token);
                    console.log(t.expires_in);
                    console.log(t.token_type);

                    $.post("/payment/payone/checkout/amazonPay/renderWidgets",
                        {
                            "accessToken": t.access_token,
                            "workOrderId": "{{ content.workOrderId }}"
                        },
                        function (data) {
                            //$('#LoginWithAmazon').append(data);
                            console.log(data);
                            $("body").append(data);
                        });


                    if (document.getElementById("walletWidgetDiv") !== undefined &&
                        document.getElementById("addressBookWidgetDiv") !== undefined) {
                        document.getElementById("walletWidgetDiv").style.display = "block";
                        document.getElementById("addressBookWidgetDiv").style.display = "block";
                    }
                    if (document.getElementsByClassName("invoice-addresses-select")[0] !== undefined && document.getElementsByClassName("shipping-addresses-select")[0] !== undefined) {
                        document.getElementsByClassName("invoice-addresses-select")[0].style.display = 'none';
                        document.getElementsByClassName("shipping-addresses-select")[0].style.display = 'none';
                    }
                    $('.shipping-addresses-select').prev('header').style.display = 'none';
                    $('.invoice-addresses-select').prev().prev().prev().prev('header').style.display = 'none';

                    document.getElementById("LoginWithAmazon").style.display = "none";
                    document.getElementById("LogoutWithAmazon").style.display = "block";
                });
            },
            onError: function (error) {
                // your error handling code.
                console.log("The following error occurred: "
                    + error.getErrorCode()
                    + ' - ' + error.getErrorMessage());
            }
        });
    }
</script>
{% if config('Payone.PAYONE_PAYONE_AMAZON_PAY.sandbox') == "true" %}
    <script async src='https://static-eu.payments-amazon.com/OffAmazonPayments/eur/sandbox/lpa/js/Widgets.js'></script>
{% else %}
    <script async src='https://static-eu.payments-amazon.com/OffAmazonPayments/eur/lpa/js/Widgets.js'></script>
{% endif %}


{% block body %}
    <button id="reinitPayone-{{order.id}}" class="btn btn-primary btn-appearance btn-block" onclick="reinit()" data-toggle="modal" data-target="#payoneModal">
        PAY
    </button>
    <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("body").append(" " +
                "<div class=\"modal fade\" id=\"payoneModal\" data-backdrop=\"static\"> " +
                "<div class=\"modal-dialog modal-lg\" role=\"document\">"+
                "<div class=\"modal-content\">"+
                "</div>" +
                "</div>" +
                "</div>");
            $("#payoneModal").data("modal-loaded", true);
        });
        function reinit() {

          const modalMethods = ['PAYONE_PAYONE_CREDIT_CARD', 'PAYONE_PAYONE_KLARNA_INSTALLMENTS'];

          const redirectMethods = ['PAYONE_PAYONE_PAY_PAL', 'PAYONE_PAYONE_INVOICE'];

            $.get("payment/payone/reinit/{{ order.id }}" , function (data) {

                if(modalMethods.includes(data.paymentCode)) {
                    $('#payoneModal .modal-content').html(data.data);
                }
                if(redirectMethods.includes(data.paymentCode)) {
                    window.location = data.data;
                }
            });
        }

        document.addEventListener('historyPaymentMethodChanged', function (e) {
            for (let property in e.detail.newOrder.order.properties) {
                if (e.detail.newOrder.order.properties[property].typeId === 3) {
                    if (e.detail.newOrder.order.properties[property].value === "{{ paymentMethodId }}") {
                        document.getElementById("reinitPayone-" + e.detail.oldOrder.id).style.display = "block";
                    } else {
                        document.getElementById("reinitPayPal-" + e.detail.oldOrder.id).style.display = "none";
                    }
                }
            }
        });
    </script>
{% endblock %}
